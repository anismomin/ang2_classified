{"version":3,"sources":["posts/components/createPost.component.ts"],"names":["CreatePostComponent","CreatePostComponent.constructor","CreatePostComponent.createPost","CreatePostComponent.upload","CreatePostComponent.fileChangeEvent","CreatePostComponent.makeFileRequest"],"mappings":"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","file":"posts/components/createPost.component.js","sourcesContent":["import {Component, EventEmitter} from 'angular2/core'\nimport {Http, Headers, HTTP_PROVIDERS}  from 'angular2/http'\nimport {ControlGroup, FormBuilder, Validators, FORM_DIRECTIVES} from 'angular2/common'\n\nimport { Router } from 'angular2/router'\n\nimport {ControlMessages} from '../../shared/components/control-messages.component'\nimport {ValidationService} from '../../shared/services/validationService'\nimport {PostService} from '../../posts/postService'\n\n@Component({\n    templateUrl: 'app/posts/templates/create.html',\n    directives: [FORM_DIRECTIVES, ControlMessages],\n    providers: [PostService, ValidationService]\n})\nexport class CreatePostComponent {\n\t\n\tpostForm: ControlGroup;\n\tpostingResponse: string;\n\tpostFormProcess = false;\n\tfilesToUpload : any;\n\t\n\n\tconstructor(private fb: FormBuilder, private _http: Http, private _postService: PostService, private _router :Router) {\n\t\t\n\t\tthis.postForm = this.fb.group({\n\t\t\t'title': ['dumytitile', Validators.compose([Validators.required])],\n\t\t\t'price': ['20', Validators.compose([Validators.required])],\n\t\t\t'category': ['mobile', Validators.compose([Validators.required])],\n\t\t\t'description': ['Checkout this description', Validators.compose([Validators.required])],\n\t\t\t'name': ['mynmae', Validators.compose([Validators.required])],\n\t\t\t'phone': ['03343853136', Validators.compose([Validators.required])],\n\t\t\t'images': [''],\n\t\t\t'state': ['sindh', Validators.compose([Validators.required])],\n\t\t\t'city': ['karachi', Validators.compose([Validators.required])]\n\t\t});\n\t}\n\n\tcreatePost(postForm) {\n\n\t\tthis.upload((images) => {\n\t\t\tvar postData = {\n\t\t\t\ttitle: postForm.title,\n\t\t\t\tprice: postForm.price,\n\t\t\t\tcategory: postForm.category,\n\t\t\t\tdescription: postForm.description,\n\t\t\t\tname: postForm.name,\n\t\t\t\tphone: postForm.phone,\n\t\t\t\timages: images,\n\t\t\t\tstate: postForm.state,\n\t\t\t\tcity: postForm.city\n\t\t\t};\n\t\t\t\n\t\t\tthis.postFormProcess = true;\n\t\t\t//JSON.stringify(postData)\n\t\t\tthis._postService.createPost(postData)\n\t\t\t\t.subscribe(\n\t\t\t\tdata => this.postingResponse = JSON.stringify(data),\n\t\t\t\terror => console.log(error),\n\t\t\t\t() => {\n\t\t\t\t\tthis.postFormProcess = false;\n\t\t\t\t\tconsole.log(this.postingResponse);\n\t\t\t\t\tthis._router.navigate(['Posts']);\n\t\t\t\t}\n\t\t\t\t);\n\t\t});\n\n\t}\n\n    upload(cb) {\n        this.makeFileRequest(\"http://localhost:3000/post/upload\", [], this.filesToUpload)\n        .then((result) => {\n\t\t\tvar img = [];\n\t\t\tObject.keys(result).forEach((key) => {\t\n\t\t\t\tvar res = result[key].path.split(\"client\");\t\t\n\t\t\t\timg.push({ path: res[1] });\n\t\t\t\t//console.debug(\"Input File name: \" + result[key].name + \" type:\" + result[key].size + \" size:\" + result[key].size);\n\t\t\t});\n\t\t\tcb(img);\n        }, (error) => {\n            console.debug(error);\n        });\n    }\n\n\tfileChangeEvent(fileInput: any) {\n        this.filesToUpload = fileInput.target.files;\n    }\n\n    makeFileRequest(url: string, params: Array<string>, files: Array<File>) {\n\n        return new Promise((resolve, reject) => {\n            var formData: any = new FormData();\n            var xhr = new XMLHttpRequest();\n            for (var i = 0; i < files.length; i++) {\n                formData.append(\"uploads\", files[i], files[i].name);\n            }\n            xhr.onreadystatechange = function() {\n                if (xhr.readyState == 4) {\n                    if (xhr.status == 200) {\n                        resolve(JSON.parse(xhr.response));\n                    } else {\n                        reject(xhr.response);\n                    }\n                }\n            }\n            xhr.open(\"POST\", url, true);\n            xhr.send(formData);\n        });\n    }\n}\n"],"sourceRoot":"/source/"}